"use strict";var BannerStyle;!function(e){e[e.info=0]="info",e[e.notice=1]="notice",e[e.error=2]="error"}(BannerStyle||(BannerStyle={}));class PushyAdmin{constructor(){this.initEventHandlers()}initEventHandlers(){document.getElementById("publish").addEventListener("click",e=>{e.preventDefault();const t=this.getSelectedItems();t&&this.publishItems(t)});const e=document.getElementById("select-all");e.addEventListener("click",()=>{const t=document.getElementsByClassName("selectbox");for(const n of t)n.checked=e.checked;this.enablePublishButton()});document.getElementById("summary").addEventListener("input",()=>{this.enablePublishButton()})}getSelectedItems(){const e={paths:[],summary:"",notes:""},t=document.getElementById("summary"),n=document.getElementById("summary-alert");if(!t.value)return t.classList.add("invalid"),void n.classList.add("invalid");t.classList.remove("invalid"),n.classList.remove("invalid"),e.summary=t.value;const s=document.getElementById("notes");e.notes=s.value;const a=document.getElementsByClassName("selectbox");for(const t of a)t.checked&&e.paths.push(t.value);return e}async fetchItems(){let e;try{const t=await fetch(window.location.pathname+"/pushy:readItems",{method:"POST"});if(!t.ok)return void this.setBannerText("Read Items: No valid response from server.",BannerStyle.error);e=await t.json()}catch(e){return void this.setBannerText("Read Items: Unexpected error while accessing the server.",BannerStyle.error)}e&&(this.setBannerText(`Found ${Object.keys(e).length} changed items.`,BannerStyle.info),this.displayItems(e))}clearInputs(){const e=document.querySelectorAll("input, textarea");for(const t of e)t.value="",t.checked=!1}displayItems(e){this.clearInputs();const t=document.getElementById("itemlist");t.innerHTML="",Object.keys(e).forEach((n,s)=>{const a=e[n],l=document.createElement("tr");l.innerHTML="",l.innerHTML=`\n                <td class="select">\n                    <input id="selectbox${s}" class="selectbox" type="checkbox" value="${a.path}">\n                </td>\n                <td class="path"><label for="selectbox${s}">${a.path}</td>\n            `,t.appendChild(l)});const n=document.getElementsByClassName("selectbox");for(const e of n)e.addEventListener("click",()=>{this.enablePublishButton()})}async publishItems(e){let t;this.clearBannerText();try{t=await fetch(window.location.pathname+"/pushy:publishItems",{method:"POST",body:JSON.stringify(e)})}catch(e){return void this.setBannerText("Publish items: Unexpected error while accessing the server.",BannerStyle.error)}if(t.ok){const e=await t.json();e.isSuccess?this.setBannerText(e.alert,BannerStyle.info):this.setBannerText(e.alert,BannerStyle.error),this.fetchItems()}else this.setBannerText("No valid response from server.",BannerStyle.error)}setBannerText(e,t){const n=document.createElement("div");n.className=BannerStyle[t]+" alert publish";const s=document.createTextNode(e);n.appendChild(s);const a=document.getElementById("messages");null==a||a.appendChild(n)}clearBannerText(){const e=document.getElementsByClassName("alert publish"),t=document.getElementById("messages");for(const n of e)null==t||t.removeChild(n)}enablePublishButton(){const e=document.getElementById("summary"),t=document.querySelectorAll(".selectbox:checked").length>0,n=document.getElementById("publish");e.value&&t?n.classList.add("enabled"):n.classList.remove("enabled")}}const admin=new PushyAdmin;admin.fetchItems();