"use strict";class PushyAdmin{constructor(){this.initEventHandlers()}initEventHandlers(){document.getElementById("publish").addEventListener("click",e=>{e.preventDefault();const t=this.getSelectedItems();t&&this.publishItems(t)});const e=document.getElementById("select-all");e.addEventListener("click",()=>{const t=document.getElementsByClassName("selectbox");for(const s of t)s.checked=e.checked;this.enablePublishButton()});document.getElementById("summary").addEventListener("input",()=>{this.enablePublishButton()})}getSelectedItems(){const e={paths:[],summary:"",notes:""},t=document.getElementById("summary"),s=document.getElementById("summary-alert");if(!t.value)return t.classList.add("invalid"),void s.classList.add("invalid");t.classList.remove("invalid"),s.classList.remove("invalid"),e.summary=t.value;const n=document.getElementById("notes");e.notes=n.value;const l=document.getElementsByClassName("selectbox");for(const t of l)t.checked&&e.paths.push(t.value);return e}async fetchItems(){let e;try{const t=await fetch(window.location.pathname+"/pushy:readItems",{method:"POST"});if(!t.ok)return void this.setBannerText("Read Items: No valid response from server.","error");e=await t.json()}catch(e){return void this.setBannerText("Read Items: Unexpected error while accessing the server.","error")}e&&(this.updateMenuBadge(e),this.displayItems(e))}clearInputs(){const e=document.querySelectorAll("input, textarea");for(const t of e)t.value="",t.checked=!1}updateMenuBadge(e){const t=document.querySelectorAll("#admin-menu li"),s=t[Array.from(t).findIndex(e=>{var t;return"Publish"==(null===(t=e.querySelector("em"))||void 0===t?void 0:t.innerHTML)})].querySelector("#admin-menu li a .badge.count");if(s){const t=Object.keys(e).length;s.innerHTML=t>0?t.toString():""}}displayItems(e){this.clearInputs();const t=document.getElementById("itemlist");t.innerHTML="",Object.keys(e).forEach((s,n)=>{const l=e[s],a=document.createElement("tr");a.innerHTML="",a.innerHTML=`\n                <td class="select">\n                    <input id="selectbox${n}" class="selectbox" type="checkbox" value="${l.path}">\n                </td>\n                <td class="path"><label for="selectbox${n}">${l.path}</td>\n            `,t.appendChild(a)});const s=document.getElementsByClassName("selectbox");for(const e of s)e.addEventListener("click",()=>{this.enablePublishButton()})}async publishItems(e){let t;try{t=await fetch(window.location.pathname+"/pushy:publishItems",{method:"POST",body:JSON.stringify(e)})}catch(e){return void this.setBannerText("Publish items: Unexpected error while accessing the server.","error")}if(t.ok){const e=await t.json();e.isSuccess?this.setBannerText(e.alert,"info"):this.setBannerText(e.alert,"error"),this.fetchItems()}else this.setBannerText("No valid response from server.","error")}setBannerText(e,t){this.clearBannerText();const s=document.createElement("div");s.className=t+" alert publish";const n=document.createTextNode(e);s.appendChild(n);const l=document.getElementById("messages");null==l||l.appendChild(s)}clearBannerText(){const e=document.getElementsByClassName("alert publish"),t=document.getElementById("messages");for(const s of e)null==t||t.removeChild(s)}enablePublishButton(){const e=document.getElementById("summary"),t=document.querySelectorAll(".selectbox:checked").length>0,s=document.getElementById("publish");e.value&&t?s.classList.add("enabled"):s.classList.remove("enabled")}}const admin=new PushyAdmin;admin.fetchItems();